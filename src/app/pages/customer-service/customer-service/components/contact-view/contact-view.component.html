<div class="h-full w-full overflow-auto">
  <div class="flex-col relative pb-8" *ngIf="messageHistoryList">
    <div
      class="flex w-full px-4 pt-4"
      *ngFor="let message of messageHistoryList"
      [ngStyle]="{
        'justify-content':
          message.messageStatus == 2 ? 'flex-start' : 'flex-end'
      }"
    >
      <div
        *ngIf="message.messageType === 1 && message.body"
        class="flex flex-col bg-white relative w-[60%] shadow-md rounded-lg px-2 pt-3 pb-2 h-fit"
      >
        <div
          class="w-[25px] absolute"
          [ngClass]="
            message.messageStatus == 1
              ? 'sent-message-pp'
              : 'received-message-pp'
          "
        >
          <img
            *ngIf="message.senderProfilePictureUri"
            class="rounded-[50%]"
            id="profilePic2"
            [ngClass]="
              message.messageStatus == 1
                ? 'sent-message-pp'
                : 'received-message-pp'
            "
            [src]="message.senderProfilePictureUri"
          />
          <mat-icon
            *ngIf="!message.senderProfilePictureUri"
            id="profilePic2"
            class="rounded-full flex absolute -bottom-4 -right-3 object-contain bg-white"
            svgIcon="profile2"
            [ngClass]="
              message.messageStatus == 1
                ? 'sent-message-pp'
                : 'received-message-pp'
            "
          ></mat-icon>
        </div>

        <div
          *ngIf="!isDepartmentChat"
          class="w-[30px] -left-[4%] -top-[13%] absolute"
          [ngClass]="
            message.messageStatus == 1
              ? 'sent-message-icon'
              : 'received-message-icon'
          "
        >
          <img
            class="rounded-[50%]"
            [src]="message.sourceCommunicationChannelIconUri"
          />
        </div>
        <div
          class="flex absolute font-medium text-xxs"
          [ngClass]="
            message.messageStatus == 1
              ? 'sent-message-time'
              : 'received-message-time'
          "
        >
          <div class="text-accent"></div>
          <div class="text-right text-[#00000073]">
            {{ message.sentOn | date : "shortTime" }}
          </div>
        </div>

        <div
          *ngIf="isDepartmentChat"
          class="w-[34px] -left-[5%] -top-[6%] absolute"
          [ngClass]="
            message.messageStatus == 1
              ? 'sent-message-icon'
              : 'received-message-icon'
          "
        >
          <img
            src="assets/images/customer-service-icons/department-chat-icon.svg"
          />
        </div>

        <div class="text-left text-xs pl-3 pr-1 w-[90%]">
          <span class="bg-white text-black">
            {{ message.body }}
          </span>
        </div>

        <!-- <div
          class="w-[25px] pr-1 -left-[4%] top-[72%] absolute cursor-pointer"
          *ngIf="!item.sent"
          [ngClass]="item.sent ? 'sent-message-icon' : 'received-message-icon'"
        >
          <div>
            <mat-icon
              (click)="onOpenProcessImage(item.id)"
              svgIcon="customer-contact-form-image-processing"
            ></mat-icon>
          </div>
        </div> -->

        <div
          class="w-fit shadow-2xl p-2 rounded-[25px] border absolute right-[8%] top-[43 %] z-[100] bg-[#005f83]"
          *ngIf="
            imageProcessingClicked && selectedImageForProcessing == message.id
          "
        >
          <ng-container *ngFor="let imageItem of imageProcessingOptions">
            <div
              class="bg-[#005f83] hover:bg-[#3b809b] w-48 text-[12px] py-1 px-4 rounded-3xl text-white cursor-pointer mb-2 font-semibold"
            >
              {{ imageItem }}
            </div>
          </ng-container>
        </div>
      </div>
      <!-- <div
          class="w-[25px] pr-1 -left-[4%] top-[72%] absolute cursor-pointer"
          *ngIf="!item.sent"
          [ngClass]="item.sent ? 'sent-message-icon' : 'received-message-icon'"
        >
          <div>
            <mat-icon
              (click)="onOpenProcessLocation(item.id)"
              svgIcon="customer-contact-form-location"
            ></mat-icon>
          </div>
        </div> -->
      <!-- 
        <div
          *ngIf="
            locationProcessingClicked &&
            selectedLocationForProcessing == item.id
          "
          class="w-56 shadow-2xl p-4 text-white text-[12px] mb-2 font-semibold rounded-[25px] border absolute right-[8%] top-[43 %] z-[100] bg-[#005f83]"
        >
          <div class="flex justify-center flex-wrap">
            <label class="flex-[50%] pb-8">District</label>
            <label class="flex-[50%] pb-8">Long/Lat</label>
            <label class="flex-[50%] pb-8">City</label>
            <label class="flex-[50%] pb-8">Google Code</label>
            <label class="flex-[50%] pb-8">Street</label>
          </div>
        </div> -->

      <div
        *ngIf="message.messageType === 2 && message.body"
        class="flex flex-col bg-white relative w-[60%] shadow-md rounded-lg px-2 pt-3 pb-2 h-fit"
      >
        <div
          class="w-[25px] absolute"
          [ngClass]="
            message.messageStatus == 1
              ? 'sent-message-pp'
              : 'received-message-pp'
          "
        >
          <img
            *ngIf="message.senderProfilePictureUri"
            class="rounded-[50%]"
            id="profilePic2"
            [ngClass]="
              message.messageStatus == 1
                ? 'sent-message-pp'
                : 'received-message-pp'
            "
            [src]="message.senderProfilePictureUri"
          />
          <mat-icon
            *ngIf="!message.senderProfilePictureUri"
            id="profilePic2"
            class="rounded-full flex absolute -bottom-4 -right-3 object-contain bg-white"
            svgIcon="profile2"
            [ngClass]="
              message.messageStatus == 1
                ? 'sent-message-pp'
                : 'received-message-pp'
            "
          ></mat-icon>
        </div>

        <div
          *ngIf="!isDepartmentChat"
          class="w-[30px] -left-[4%] -top-[21%] absolute"
          [ngClass]="
            message.messageStatus == 1
              ? 'sent-message-icon'
              : 'received-message-icon'
          "
        >
          <img
            class="rounded-[50%]"
            [src]="message.sourceCommunicationChannelIconUri"
          />
        </div>
        <div
          class="flex absolute font-medium text-xxs"
          [ngClass]="
            message.messageStatus == 1
              ? 'sent-message-time'
              : 'received-message-time'
          "
        >
          <div class="text-accent"></div>
          <div class="text-right text-[#00000073]">
            {{ message.sentOn | date : "shortTime" }}
          </div>
        </div>

        <div
          *ngIf="isDepartmentChat"
          class="w-[34px] -left-[5%] -top-[6%] absolute"
          [ngClass]="
            message.messageStatus == 1
              ? 'sent-message-icon'
              : 'received-message-icon'
          "
        >
          <img
            src="assets/images/customer-service-icons/department-chat-icon.svg"
          />
        </div>

        <div class="text-left text-xs pl-3 pr-1 w-[90%]">
          <div
            class="w-full h-full text-black"
            [innerHTML]="message.body | safeHtml"
          ></div>
        </div>

        <!-- <div
              class="w-[25px] pr-1 -left-[4%] top-[72%] absolute cursor-pointer"
              *ngIf="!item.sent"
              [ngClass]="item.sent ? 'sent-message-icon' : 'received-message-icon'"
            >
              <div>
                <mat-icon
                  (click)="onOpenProcessImage(item.id)"
                  svgIcon="customer-contact-form-image-processing"
                ></mat-icon>
              </div>
            </div> -->

        <div
          class="w-fit shadow-2xl p-2 rounded-[25px] border absolute right-[8%] top-[43 %] z-[100] bg-[#005f83]"
          *ngIf="
            imageProcessingClicked && selectedImageForProcessing == message.id
          "
        >
          <ng-container *ngFor="let imageItem of imageProcessingOptions">
            <div
              class="bg-[#005f83] hover:bg-[#3b809b] w-48 text-[12px] py-1 px-4 rounded-3xl text-white cursor-pointer mb-2 font-semibold"
            >
              {{ imageItem }}
            </div>
          </ng-container>
        </div>
      </div>

      <div
        *ngIf="message.messageType === 3"
        class="flex flex-col bg-white relative w-[60%] -right-[40%] shadow-md rounded-lg px-2 pt-4 pb-2 h-fit"
      >
        <div class="text-left text-xs">
          <span class="bg-white text-black">
            <div
              *ngFor="let bodyItem of message.body.componentList"
              class="p-1"
            >
              <div
                *ngIf="containsHttp(bodyItem.componentValue)"
                class="flex flex-row"
              >
                <div class="w-1/2">{{ bodyItem.componentName }}</div>
                <div
                  *ngIf="bodyItem.componentName === 'ExtractedImage'"
                  class="w-1/2"
                >
                  <img
                    [src]="bodyItem.componentValue"
                    width="200"
                    height="200"
                  />
                </div>
                <div
                  *ngIf="bodyItem.componentName !== 'ExtractedImage'"
                  class="w-1/2"
                >
                  <img [src]="bodyItem.componentValue" width="50" height="50" />
                </div>
              </div>
              <div
                *ngIf="!containsHttp(bodyItem.componentValue)"
                class="flex flex-row"
              >
                <div class="w-1/2">{{ bodyItem.componentName }}</div>
                <div class="w-1/2">{{ bodyItem.componentValue }}</div>
              </div>
            </div>
          </span>
        </div>
        <div class="flex justify-between items-center font-medium text-xxs">
          <div class="text-accent"></div>
          <div class="text-right">
            {{ message.sentOn | date : "shortTime" }}
          </div>
        </div>
      </div>

      <div
        *ngIf="message.messageType === 4 && message.body"
        class="flex flex-col bg-white relative w-[60%] shadow-md rounded-lg px-2 pt-3 pb-2 h-fit"
      >
        <div
          class="w-[25px] absolute"
          [ngClass]="
            message.messageStatus == 1
              ? 'sent-img-message-pp'
              : 'received-img-message-pp'
          "
        >
          <img
            *ngIf="message.senderProfilePictureUri"
            class="rounded-[50%]"
            id="profilePic2"
            [src]="message.senderProfilePictureUri"
          />
          <mat-icon
            *ngIf="!message.senderProfilePictureUri"
            id="profilePic2"
            class="rounded-full flex absolute -bottom-4 -right-3 object-contain bg-white"
            svgIcon="profile2"
          ></mat-icon>
        </div>

        <div
          *ngIf="!isDepartmentChat"
          class="w-[30px] absolute"
          [ngClass]="
            message.messageStatus == 1
              ? 'sent-img-message-icon'
              : 'received-img-message-icon'
          "
        >
          <img
            class="rounded-[50%]"
            [src]="message.sourceCommunicationChannelIconUri"
          />
        </div>
        <div
          class="flex absolute font-medium text-xxs"
          [ngClass]="
            message.messageStatus == 1
              ? 'sent-message-time'
              : 'received-message-time'
          "
        >
          <div class="text-accent"></div>
          <div class="text-right text-[#00000073]">
            {{ message.sentOn | date : "shortTime" }}
          </div>
        </div>

        <div
          *ngIf="isDepartmentChat"
          class="w-[34px] -left-[5%] absolute"
          [ngClass]="
            message.messageStatus == 1
              ? 'sent-img-message-icon'
              : 'received-img-message-icon'
          "
        >
          <img
            src="assets/images/customer-service-icons/department-chat-icon.svg"
          />
        </div>

        <div>
          <div class="text-left text-xs pt-3">
            <img [src]="message.body" />
          </div>
        </div>

        <div
          class="w-[25px] pr-1 -right-[4%] -bottom-[5%] absolute cursor-pointer"
          *ngIf="message.messageType == 4 && message.messageStatus == 2"
        >
          <div>
            <mat-icon
              (click)="onOpenProcessImage(message.id)"
              svgIcon="customer-contact-form-image-processing"
            ></mat-icon>
          </div>
        </div>

        <div
          class="w-fit shadow-2xl p-2 rounded-[25px] border absolute right-[4%] bottom-[3%] z-[100] bg-[#005f83]"
          *ngIf="
            imageProcessingClicked && selectedImageForProcessing == message.id
          "
        >
          <ng-container *ngFor="let imageItem of imageProcessingOptions">
            <div
              class="bg-[#005f83] hover:bg-[#3b809b] w-48 text-[12px] py-1 px-4 rounded-3xl text-white cursor-pointer mb-2 font-semibold"
            >
              {{ imageItem }}
            </div>
          </ng-container>
        </div>
      </div>
    </div>
    <div
      class="absolute flex justify-center items-end w-full h-full bottom-12"
      *ngIf="spinner"
    >
      <mat-spinner></mat-spinner>
    </div>
  </div>
</div>


